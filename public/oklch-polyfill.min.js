!function(){"use strict";!function(){if(!function(){if("undefined"==typeof CSS||!CSS.supports)return!0;try{return!CSS.supports("color","oklch(0.7 0.15 250)")||!CSS.supports("color","oklch(from red l c h)")}catch(t){return!0}}())return;class t{static oklchToRgb(t,e,r){const{L:o,a:s,b:l}=this.oklchToOklab(t,e,r),{r:c,g:i,b:a}=this.oklabToLinearRgb(o,s,l);return this.linearRgbToSrgb(c,i,a)}static oklchToOklab(t,e,r){const o=r*Math.PI/180;return{L:t,a:e*Math.cos(o),b:e*Math.sin(o)}}static oklabToLinearRgb(t,e,r){const o=t+.3963377774*e+.2158037573*r,s=t-.1055613458*e-.0638541728*r,l=t-.0894841775*e-1.291485548*r,c=o*o*o,i=s*s*s,a=l*l*l;return{r:4.0767416621*c-3.3077115913*i+.2309699292*a,g:-1.2684380046*c+2.6097574011*i-.3413193965*a,b:-.0041960863*c-.7034186147*i+1.707614701*a}}static linearRgbToSrgb(t,e,r){const o=t=>{const e=Math.abs(t);return e>.0031308?Math.sign(t)*(1.055*Math.pow(e,1/2.4)-.055):12.92*t};return{r:Math.max(0,Math.min(255,Math.round(255*o(t)))),g:Math.max(0,Math.min(255,Math.round(255*o(e)))),b:Math.max(0,Math.min(255,Math.round(255*o(r))))}}static parseOklchToRgb(t){const e=t.match(/oklch\(\s*([^)]+)\s*\)/);if(!e)return null;const r=e[1].split(/\s+/).map((t=>parseFloat(t.trim())));if(3!==r.length)return null;const[o,s,l]=r,{r:c,g:i,b:a}=this.oklchToRgb(o,s,l);return`rgb(${c}, ${i}, ${a})`}static applyRelativeTransform(t,e,r,o,s,l){const c=(t,e,r,o)=>{if("l"===t)return e;if("c"===t)return r;if("h"===t)return o;if(t.includes("calc(")){let s=t.replace("calc(","").replace(")","");s=s.replace(/\bl\b/g,e),s=s.replace(/\bc\b/g,r),s=s.replace(/\bh\b/g,o);try{return Function(`"use strict"; return (${s})`)()}catch(s){return"l"===t?e:"c"===t?r:o}}return parseFloat(t)||0};return{l:c(o,t,e,r),c:c(s,t,e,r),h:c(l,t,e,r)}}}class e{static extractOklchProperties(){const t=new Map;getComputedStyle(document.documentElement);for(const e of document.styleSheets)try{this.parseStyleSheet(e,t)}catch(t){}return t}static parseStyleSheet(t,e){if(t.cssRules)for(const r of t.cssRules)r.type===CSSRule.STYLE_RULE?this.parseStyleRule(r,e):r.type===CSSRule.MEDIA_RULE&&this.parseStyleSheet(r,e)}static parseStyleRule(t,e){for(let r=0;r<t.style.length;r++){const o=t.style[r],s=t.style.getPropertyValue(o);o.startsWith("--")&&this.containsOklch(s)&&e.set(o,s.trim())}}static containsOklch(t){return t.includes("oklch(")||t.includes("color-mix(in oklch")}static parseRelativeOklch(t){const e=t.match(/oklch\(\s*from\s+(var\([^)]+\)|oklch\([^)]+\))\s+([^)]+)\s*\)/);if(!e)return null;const[,r,o]=e,s=o.trim().split(/\s+/);return 3!==s.length?null:{from:r.trim(),lightness:s[0],chroma:s[1],hue:s[2]}}static parseSimpleOklch(t){const e=t.match(/oklch\(\s*([0-9.]+)\s+([0-9.]+)\s+([0-9.]+)\s*\)/);return e?{l:parseFloat(e[1]),c:parseFloat(e[2]),h:parseFloat(e[3])}:null}static parseColorMix(t){const e=t.match(/color-mix\(\s*in\s+oklch\s*,\s*([^,]+),\s*([^)]+)\s*\)/);if(!e)return null;const[,r,o]=e,s=t=>{const e=t.match(/(.+?)\s+(\d+)%/);return e?{color:e[1].trim(),percentage:parseFloat(e[2])}:{color:t.trim(),percentage:50}};return{color1:s(r),color2:s(o)}}static resolveCSSVariable(t){const e=t.match(/var\(\s*([^,)]+)(?:\s*,\s*([^)]+))?\s*\)/);if(!e)return null;const[,r,o]=e;return getComputedStyle(document.documentElement).getPropertyValue(r.trim())||o||null}static getBaseColors(){const t=new Map,e=getComputedStyle(document.documentElement),r=["--color-primary","--color-secondary","--color-tertiary","--color-neutral","--color-success","--color-attention","--color-error","--color-promotion"];for(const o of r){const r=e.getPropertyValue(o);if(r&&this.containsOklch(r)){const e=this.parseSimpleOklch(r);e&&t.set(o,e)}}return t}}class r{static processRelativeColors(t){const r=new Map,o=e.getBaseColors();for(const[e,s]of t){const l=this.processProperty(e,s,o,t);l&&r.set(e,l)}return r}static processProperty(r,o,s,l){const c=e.parseRelativeOklch(o);if(c)return this.processRelativeColor(c,s,l);const i=e.parseSimpleOklch(o);if(i)return t.oklchToRgb(i.l,i.c,i.h);const a=e.parseColorMix(o);return a?this.processColorMix(a,s,l):null}static processRelativeColor(e,r,o){const s=this.resolveBaseColor(e.from,r,o);if(!s)return null;const l=t.applyRelativeTransform(s.l,s.c,s.h,e.lightness,e.chroma,e.hue);return t.oklchToRgb(l.l,l.c,l.h)}static resolveBaseColor(t,r,o){if(t.startsWith("var(")){const s=t.match(/var\(\s*([^,)]+)/)?.[1];if(!s)return null;if(r.has(s))return r.get(s);if(o.has(s)){const t=o.get(s),r=e.parseSimpleOklch(t);if(r)return r}const l=e.resolveCSSVariable(t);if(l){const t=e.parseSimpleOklch(l);if(t)return t}}return t.startsWith("oklch(")?e.parseSimpleOklch(t):null}static processColorMix(t,e,r){const o=this.resolveColorValue(t.color1.color,e,r),s=this.resolveColorValue(t.color2.color,e,r);if(!o||!s)return console.warn("Could not resolve colors for color-mix"),null;const l=t.color1.percentage/100,c=t.color2.percentage/100,i=l+c,a=l/i,n=c/i;return{r:Math.round(o.r*a+s.r*n),g:Math.round(o.g*a+s.g*n),b:Math.round(o.b*a+s.b*n)}}static resolveColorValue(r,o,s){if("red"===r)return{r:255,g:0,b:0};if("blue"===r)return{r:0,g:0,b:255};if("white"===r)return{r:255,g:255,b:255};if("black"===r)return{r:0,g:0,b:0};if(r.startsWith("var(")){const o=e.resolveCSSVariable(r);if(o){const r=e.parseSimpleOklch(o);if(r)return t.oklchToRgb(r.l,r.c,r.h)}}if(r.startsWith("oklch(")){const o=e.parseSimpleOklch(r);if(o)return t.oklchToRgb(o.l,o.c,o.h)}return null}static generateShadeVariants(e,r){const o=new Map,s={50:{l:"calc(1 - (1 - l) * 0.6)",c:"calc(c * 0.8)",h:"h",iterations:4},100:{l:"calc(1 - (1 - l) * 0.6)",c:"calc(c * 0.8)",h:"h",iterations:3},200:{l:"calc(1 - (1 - l) * 0.6)",c:"calc(c * 0.8)",h:"h",iterations:2},300:{l:"calc(1 - (1 - l) * 0.6)",c:"calc(c * 0.8)",h:"h",iterations:1},400:{l:"calc(1 - (1 - l) * 0.6)",c:"calc(c * 0.8)",h:"h",iterations:0},500:{l:"l",c:"c",h:"h"},600:{l:"calc(l * 0.8)",c:"calc(c * 1.1)",h:"h",iterations:0},700:{l:"calc(l * 0.8)",c:"calc(c * 1.1)",h:"h",iterations:1},800:{l:"calc(l * 0.8)",c:"calc(c * 1.1)",h:"h",iterations:2},900:{l:"calc(l * 0.8)",c:"calc(c * 1.1)",h:"h",iterations:3},950:{l:"calc(l * 0.8)",c:"calc(c * 1.1)",h:"h",iterations:4}};for(const[l,c]of Object.entries(s)){let s={...e};for(let e=0;e<=(c.iterations||0);e++)s=t.applyRelativeTransform(s.l,s.c,s.h,c.l,c.c,c.h);const i=t.oklchToRgb(s.l,s.c,s.h);o.set(`--color-${r}-${l}`,i)}return o}}class o{constructor(){this.version="1.0.0",this.isPolyfilled=!1,this.supported=this.checkNativeSupport(),this.initialized=!1,this.rgbFallbacks=new Map,this.refresh=this.refresh.bind(this),this.handleMutation=this.handleMutation.bind(this)}checkNativeSupport(){if("undefined"==typeof CSS||!CSS.supports)return!1;try{return CSS.supports("color","oklch(0.7 0.15 250)")&&CSS.supports("color","oklch(from red l c h)")}catch(t){return!1}}init(){this.initialized||(this.supported||(console.log("Altitude OKLCH Polyfill v"+this.version+" activated"),this.isPolyfilled=!0,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>this.activate())):this.activate()),this.initialized=!0)}activate(){try{this.processOklchColors(),this.setupMutationObserver()}catch(t){console.error("Failed to activate OKLCH polyfill:",t)}}processOklchColors(){const t=e.extractOklchProperties();if(0===t.size)return;const o=r.processRelativeColors(t);this.generateBaseColorShades(o),this.applyRgbFallbacks(o)}generateBaseColorShades(t){const o=e.getBaseColors();for(const[e,s]of o){const o=e.replace("--color-",""),l=r.generateShadeVariants(s,o);for(const[e,r]of l)t.set(e,r)}}applyRgbFallbacks(t){const e=document.documentElement;for(const[r,o]of t)if(o&&"object"==typeof o&&"r"in o){const t=`rgb(${o.r}, ${o.g}, ${o.b})`;e.style.setProperty(r,t),this.rgbFallbacks.set(r,t)}}setupMutationObserver(){"undefined"!=typeof MutationObserver&&new MutationObserver((t=>{let e=!1;for(const r of t){if("attributes"===r.type&&"style"===r.attributeName){e=!0;break}if("childList"===r.type&&(r.addedNodes.length>0||r.removedNodes.length>0))for(const t of r.addedNodes)if(t.nodeType===Node.ELEMENT_NODE&&("STYLE"===t.tagName||"LINK"===t.tagName)){e=!0;break}}e&&(clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout((()=>this.refresh()),100))})).observe(document.documentElement,{attributes:!0,attributeFilter:["style"],childList:!0,subtree:!0})}refresh(){this.isPolyfilled&&this.processOklchColors()}handleMutation(){this.refresh()}getStatus(){return{version:this.version,supported:this.supported,isPolyfilled:this.isPolyfilled,initialized:this.initialized,fallbackCount:this.rgbFallbacks.size}}convertColor(e){return t.parseOklchToRgb(e)}}const s=new o;"undefined"!=typeof window&&(window.AltitudeOklchPolyfill=s,window.AltitudeOklchPolyfillClass=o),s.init()}()}();